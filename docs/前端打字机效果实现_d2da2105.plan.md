---
name: 前端打字机效果实现
overview: 在前端实现打字机效果，将批量到达的数据存入队列，使用 requestAnimationFrame 逐字显示，模拟 ChatGPT 式的流式输出体验。
todos:
  - id: typewriter-effect
    content: 在 AIOutputView 中实现打字机效果，使用 requestAnimationFrame 逐字显示
    status: completed
  - id: cursor-effect
    content: 添加光标闪烁效果增强视觉体验
    status: completed
  - id: cleanup-debug
    content: 测试成功后清理调试日志
    status: in_progress
---

# 前端打字机效果实现

## 核心思路

后端数据批量到达时，不立即全部显示，而是：

1. 将新数据追加到"待显示队列"
2. 使用 `requestAnimationFrame` 逐字从队列取出
3. 更新已显示的内容

## 修改文件

### 1. [AIOutputView.tsx](frontend/src/pages/Workspace/components/AIOutputView.tsx)

添加打字机效果逻辑：

```typescript
// 新增 props
interface Props {
  content: string           // 后端累积的全部内容
  // ... 其他现有 props
}

// 组件内部状态
const [displayedContent, setDisplayedContent] = useState('')
const displayedLengthRef = useRef(0)

// 打字机效果核心逻辑
useEffect(() => {
  if (content.length > displayedLengthRef.current) {
    // 有新内容需要显示
    const animate = () => {
      if (displayedLengthRef.current < content.length) {
        // 每帧显示 1-3 个字符（可调节速度）
        const charsToAdd = Math.min(3, content.length - displayedLengthRef.current)
        displayedLengthRef.current += charsToAdd
        setDisplayedContent(content.slice(0, displayedLengthRef.current))
        requestAnimationFrame(animate)
      }
    }
    requestAnimationFrame(animate)
  }
}, [content])

// 渲染时使用 displayedContent 而不是 content
<div dangerouslySetInnerHTML={{ __html: renderMarkdown(displayedContent) }} />
```

### 2. 可选：添加光标闪烁效果

在文字末尾添加一个闪烁的光标，增强打字效果：

```css
.typing-cursor {
  display: inline-block;
  width: 2px;
  height: 1em;
  background: #a78bfa;
  animation: blink 0.8s infinite;
}
@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}
```

## 打字速度控制

- 每帧显示 1-3 个字符
- 60fps 下约 60-180 字符/秒
- 可根据用户反馈调整