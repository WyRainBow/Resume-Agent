# AI 工具封装方案

## 概述

基于 Agent + Tools 架构模式，实现简历操作的工具层。LLM 作为 Agent（大脑）负责理解和决策，Tools 作为执行层（手脚）负责具体操作简历数据。

---

## 架构设计

```
┌─────────────────────────────────────────┐
│         对话界面 (Conversation UI)       │
│    左侧：对话区域  |  右侧：简历预览      │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         工具层 (Tool Layer)              │
│  ┌─────────────┐  ┌─────────────┐       │
│  │  CVReader   │  │  CVEditor   │       │
│  │  读取简历    │  │  编辑简历    │       │
│  └─────────────┘  └─────────────┘       │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         数据层 (Data Layer)              │
│         ResumeData (JSON 格式)           │
└─────────────────────────────────────────┘
```

---

## 工具设计

### 1. CVReader 工具

**功能**：读取简历数据，将结构化数据提供给 LLM 进行分析

**输入参数**：
- `path`（可选）：指定读取的路径，如 `education[0]`、`skills` 等
- 不传则返回完整简历数据

**输出格式**：
```json
{
  "status": "success",
  "data": { ... },  // 简历数据（完整或部分）
  "message": "读取成功"
}
```

**使用场景**：
- 全面分析简历内容
- 读取特定模块进行优化
- 上下文理解和信息校验

---

### 2. CVEditor 工具

**功能**：修改、添加、删除简历中的具体内容

**输入参数**：
- `path`（必需）：操作路径，如 `education[0].school`、`skills[1].name`
- `action`（必需）：操作类型 - `update` | `add` | `delete`
- `value`（update/add 时必需）：要设置的新值

**路径格式规则**：
- 使用点号（`.`）分隔层级
- 数组使用方括号索引（`items[0]`）
- 示例：`education[0].description`、`projects[1].title`

**输出格式**：
```json
{
  "status": "success" | "error",
  "message": "操作结果描述",
  "path": "操作的路径"
}
```

**支持的操作**：
1. **update**：更新指定路径的值
2. **add**：向数组添加新项
3. **delete**：删除指定路径的项

---

## 数据模型

基于现有的 `ResumeData` 类型，主要字段包括：

- `personalInfo`：个人信息
- `education`：教育经历数组
- `workExperience`：工作经历数组
- `projects`：项目经历数组
- `skills`：技能数组
- `menuSections`：模块配置

---

## 测试页面设计

**布局**：
- 左侧 50%：对话交互区域
- 右侧 50%：HTML 简历实时预览（复用 `HTMLTemplateRenderer` 组件）

**功能**：
1. 输入工具调用 JSON 进行测试
2. 实时查看简历数据变化
3. 验证 CVReader 和 CVEditor 的功能

---

## 实现进度

### 已完成

1. ✅ 创建 AI 工具封装.md 文档
2. ✅ 设计 CVReader 工具接口
3. ✅ 设计 CVEditor 工具接口
4. ✅ 实现 CVReader 工具
5. ✅ 实现 CVEditor 工具
6. ✅ 创建测试页面（路由：`/cv-tools-test`）
7. ✅ 测试工具功能（10/10 测试通过）

---

## 测试结果

### 测试用例（全部通过）

| 测试项 | 描述 | 结果 |
|--------|------|------|
| 路径解析 | 解析 `basic.name`、`education[0].school` 等路径 | ✅ |
| CVReader 读取全部 | 读取完整简历数据 | ✅ |
| CVReader 读取字段 | 读取 `basic.name` 返回 "张三" | ✅ |
| CVReader 读取数组项 | 读取 `education[0]` 返回第一条教育经历 | ✅ |
| CVEditor 更新顶层 | 更新 `basic.name` 为 "李四" | ✅ |
| CVEditor 更新嵌套 | 更新 `education[0].school` 为 "浙江大学" | ✅ |
| CVEditor 添加项 | 向 `education` 数组添加新项 | ✅ |
| CVEditor 删除项 | 删除 `education[1]` | ✅ |
| 错误处理-索引越界 | 访问 `education[99]` 返回错误 | ✅ |
| 错误处理-类型错误 | 对非数组执行 add 操作返回错误 | ✅ |

---

## 界面设计

### 测试页面 UI（复刻 AI 对话风格）

**布局**：
- 左侧 50%：AI 对话区域
- 右侧 50%：HTML 简历实时预览

**左侧对话区**：
- 顶部：RA AI Logo + Beta 标签 + 历史记录/新建会话按钮
- 中间：对话消息流（用户消息紫色气泡，AI 消息灰色气泡）
- 底部：快捷操作按钮 + 输入框 + 发送按钮

**右侧预览区**：
- 顶部：简历标题 + 实时更新提示
- 中间：HTML 简历渲染（使用 `HTMLTemplateRenderer` 组件）

**交互功能**：
1. 输入 JSON 工具调用并发送
2. 点击快捷按钮执行常用操作
3. 实时查看简历数据变化
4. 新建会话重置数据

---

## 清理记录

### 已删除的文件

- `frontend/src/pages/ConversationWorkspace/` - 旧的半成品对话页面（已由新的 CVToolsTest 替代）

---

## 后续规划

1. **集成 LLM**：将工具与 LLM 的 Function Calling 能力结合
2. **扩展工具**：
   - `CVTemplateList`：获取可用模板列表
   - `TemplateSwitcher`：切换简历模板
   - `SmartFitToOnePage`：智能排版
3. **上下文管理**：实现对话历史和简历状态的关联
4. **RAG 集成**：接入知识库进行简历优化建议


