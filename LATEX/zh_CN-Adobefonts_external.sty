\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{zh_CN-Adobefonts_external}[2015/05/25 zh_CN-Adobefonts_external Package]

\RequirePackage{fontspec}
\RequirePackage{xeCJK}

% https://github.com/boathit/CTEX/blob/master/texmf/tex/latex/ctex/fontset/ctex-xecjk-adobefonts.def
% ctex-xecjk-adobefonts.def: Adobe 的 xeCJK 字体设置，为 Adobe 的四套字体
% vim:ft=tex

% 多平台字体回退机制：Mac → Linux → Adobe 字体
% 1. PingFang SC (macOS)
% 2. STSong (macOS)
% 3. Noto CJK (Linux)
% 4. Adobe 字体 (通用回退)

\IfFontExistsTF{PingFang SC}{%
    % macOS: 使用 PingFang SC（苹果系统字体）
    \setCJKmainfont{PingFang SC}[
        BoldFont=PingFang SC Medium,
        ItalicFont=Kaiti SC
    ]
    \setCJKsansfont{PingFang SC Medium}
    \setCJKmonofont{STFangsong}
}{%
    \IfFontExistsTF{STSong}{%
        % macOS: 使用 STSong
        \setCJKmainfont{STSong}[
            BoldFont=STHeiti,
            ItalicFont=STKaiti
        ]
        \setCJKsansfont{STHeiti}
        \setCJKmonofont{STFangsong}
    }{%
        \IfFontExistsTF{Noto Serif CJK SC}{%
            % Linux: 使用 Noto CJK 字体
            \setCJKmainfont{Noto Serif CJK SC}[
                BoldFont=Noto Sans CJK SC Bold,
                ItalicFont=Noto Serif CJK SC
            ]
            \setCJKsansfont{Noto Sans CJK SC}
            \setCJKmonofont{Noto Sans CJK SC}
        }{%
            % 通用回退: Adobe 字体
            \defaultfontfeatures{Path = fonts/zh_CN-Adobe/, Mapping=tex-text}
            \setCJKmainfont[
                BoldFont=AdobeHeitiStd-Regular.otf,
                ItalicFont=AdobeKaitiStd-Regular.otf,
                SmallCapsFont=AdobeHeitiStd-Regular.otf,
                UprightFont=AdobeSongStd-Light.otf
            ]{AdobeSongStd-Light.otf}
            \setCJKsansfont{AdobeHeitiStd-Regular.otf}
            \setCJKmonofont{AdobeFangsongStd-Regular.otf}
        }
    }
}

% 字体族定义（兼容多平台）
\IfFontExistsTF{Noto Serif CJK SC}{%
    % Linux
    \setCJKfamilyfont{zhsong}{Noto Serif CJK SC}
    \setCJKfamilyfont{zhhei}{Noto Sans CJK SC}
    \setCJKfamilyfont{zhfs}{Noto Serif CJK SC}
    \setCJKfamilyfont{zhkai}{Noto Serif CJK SC}
}{%
    % macOS / Adobe
    \setCJKfamilyfont{zhsong}{AdobeSongStd-Light.otf}
    \setCJKfamilyfont{zhhei}{AdobeHeitiStd-Regular.otf}
    \setCJKfamilyfont{zhfs}{AdobeFangsongStd-Regular.otf}
    \setCJKfamilyfont{zhkai}{AdobeKaitiStd-Regular.otf}
}

\newcommand*{\songti}{\CJKfamily{zhsong}} % 宋体
\newcommand*{\heiti}{\CJKfamily{zhhei}}   % 黑体
\newcommand*{\kaishu}{\CJKfamily{zhkai}}  % 楷书
\newcommand*{\fangsong}{\CJKfamily{zhfs}} % 仿宋

\endinput
